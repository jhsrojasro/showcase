<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Workshop 2: 3D Brush with Depth Estimation #  Introducción #  Depth Estimation #  El problema de medir una distancia relativa a una cámara es clave en aplicaciones como vehiculos autónomos, reconstrucción de escenas 3D, creación de mapas 3D y realidad aumentada (AR). En robótica, la estimación de la profundidad es un prerequisito para realizar diferentes tareas como percepción, navegación y planeación [1].
El cálculo de la profundad, nos permite proyectar de vuelta imágenes capturadas desde distintos ángulos a una escena de tres dimensiones."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Workshop 2: 3D Brush with Depth Estimation #  Introducción #  Depth Estimation #  El problema de medir una distancia relativa a una cámara es clave en aplicaciones como vehiculos autónomos, reconstrucción de escenas 3D, creación de mapas 3D y realidad aumentada (AR). En robótica, la estimación de la profundidad es un prerequisito para realizar diferentes tareas como percepción, navegación y planeación [1].
El cálculo de la profundad, nos permite proyectar de vuelta imágenes capturadas desde distintos ángulos a una escena de tres dimensiones."><meta property="og:type" content="article"><meta property="og:url" content="https://jhsrojasro.github.io/showcase/docs/shortcodes/workshop2/3dBrush/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-05-25T10:08:30-05:00"><title>3d Brush | Showcase Template</title><link rel=manifest href=/showcase/manifest.json><link rel=icon href=/showcase/favicon.png type=image/x-icon><link rel=stylesheet href=/showcase/book.min.ab46de3e725a6415339a37bba23a0067534a37289b063c9f8d011515a63097a8.css integrity="sha256-q0bePnJaZBUzmje7ojoAZ1NKNyibBjyfjQEVFaYwl6g=" crossorigin=anonymous><script defer src=/showcase/flexsearch.min.js></script>
<script defer src=/showcase/en.search.min.152155ded180bee62aa93cf4e57d986bafc8e0abd402979a7cc30e5871eba3f1.js integrity="sha256-FSFV3tGAvuYqqTz05X2Ya6/I4KvUApeafMMOWHHro/E=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/showcase/><span>Showcase Template</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Shortcodes</span><ul><li><a href=/showcase/docs/shortcodes/integrantes/>Integrantes</a></li><li><a href=/showcase/docs/shortcodes/logs/>Logs</a></li><li><input type=checkbox id=section-317ff9256596583937fd0dc8b10b1dfa class=toggle>
<label for=section-317ff9256596583937fd0dc8b10b1dfa class="flex justify-between"><a role=button>Ml5</a></label><ul><li><a href=/showcase/docs/shortcodes/ml5/BodyPrix/>Body Prix</a></li><li><a href=/showcase/docs/shortcodes/ml5/FaceMesh/>Face Mesh</a></li><li><a href=/showcase/docs/shortcodes/ml5/HandPose/>Hand Pose</a></li><li><a href=/showcase/docs/shortcodes/ml5/image-classification/>Image Classification</a></li><li><a href=/showcase/docs/shortcodes/ml5/PoseNet/>Pose Net</a></li></ul></li><li><input type=checkbox id=section-ec67a64aba70b9df3d2a9acd6c92e3bc class=toggle>
<label for=section-ec67a64aba70b9df3d2a9acd6c92e3bc class="flex justify-between"><a href=/showcase/docs/shortcodes/p5/>P5</a></label><ul><li><a href=/showcase/docs/shortcodes/p5/div/>Div</a></li><li><a href=/showcase/docs/shortcodes/p5/iframe/>Iframe</a></li></ul></li><li><a href=/showcase/docs/shortcodes/workshop/>Workshop</a></li><li><input type=checkbox id=section-699c85deb1d28081c80315a3708d5473 class=toggle checked>
<label for=section-699c85deb1d28081c80315a3708d5473 class="flex justify-between"><a role=button>Workshop2</a></label><ul><li><a href=/showcase/docs/shortcodes/workshop2/3dBrush/ class=active>3d Brush</a></li><li><a href=/showcase/docs/shortcodes/workshop2/softwareRendering/>Software Rendering</a></li></ul></li></ul></li></ul><ul><li><a href=/showcase/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/showcase/svg/menu.svg class=book-icon alt=Menu></label>
<strong>3d Brush</strong>
<label for=toc-control><img src=/showcase/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#workshop-2-3d-brush-with-depth-estimation>Workshop 2: 3D Brush with Depth Estimation</a><ul><li><a href=#introducción><strong>Introducción</strong></a><ul><li><a href=#depth-estimation><strong>Depth Estimation</strong></a></li></ul></li><li><a href=#contexto><strong>Contexto</strong></a><ul><li><a href=#estimación-de-la-profundidad-en-visión-por-computador><strong>Estimación de la profundidad en visión por computador</strong></a></li></ul></li><li><a href=#resultados><strong>Resultados</strong></a><ul><li><a href=#conclusiones><strong>Conclusiones</strong></a></li><li><a href=#trabajo-futuro><strong>Trabajo Futuro</strong></a></li><li><a href=#referencias><strong>Referencias</strong></a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=workshop-2-3d-brush-with-depth-estimation>Workshop 2: 3D Brush with Depth Estimation
<a class=anchor href=#workshop-2-3d-brush-with-depth-estimation>#</a></h1><h2 id=introducción><strong>Introducción</strong>
<a class=anchor href=#introducci%c3%b3n>#</a></h2><h3 id=depth-estimation><strong>Depth Estimation</strong>
<a class=anchor href=#depth-estimation>#</a></h3><p>El problema de medir una distancia relativa a una cámara es clave en aplicaciones como vehiculos autónomos, reconstrucción de escenas 3D, creación de mapas 3D y realidad aumentada (AR). En robótica, la estimación de la profundidad es un prerequisito para realizar diferentes tareas como percepción, navegación y planeación [1].</p><img width=345 alt=LIDAR src=https://miro.medium.com/max/700/0*PuFkan_sqa1xUzmD.jpg><p>El cálculo de la profundad, nos permite proyectar de vuelta imágenes capturadas desde distintos ángulos a una escena de tres dimensiones. Algunos de los problemas más arduos son los de <strong>correspondence matching</strong> (encontrar características correspondientes en dos vistas distintas) que puede ser dificil debido a oclusiones o cambios en las texturas de las vistas y <strong>resolving ambiguous solution</strong> ya que muchas escenas 3D pueden generar la misma imagen en el plano de proyección, es decir, la profundidad predecida no es única [2].</p><img width=345 alt=LIDAR src=https://miro.medium.com/max/700/1*IzEBZdx8r9eLW8G7dBd9Zg.png><p>En la actualidad, para recuperar la profundidad la mejor alternativa es utilizar un dispositivo como LIDAR que permite determinar la distancia desde un emisor láser a un objeto o superficie utilizando un haz láser impulsado.</p><img width=345 alt=LIDAR src=https://www.todomecanica.com/images/blog/2021/diciembre/LIDAR-31122021.jpg><p>En visión por computador, la profundidad es extraida de dos principales maneras metodológicas: Profundidad en imaganes monoculares estáticas o secuenciales y profundidad en imágenes estéreo utilizando geometría epipolar [3].</p><img alt="Epipolar Geometry" src=https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/Aufnahme_mit_zwei_Kameras.svg/250px-Aufnahme_mit_zwei_Kameras.svg.png><h2 id=contexto><strong>Contexto</strong>
<a class=anchor href=#contexto>#</a></h2><h3 id=estimación-de-la-profundidad-en-visión-por-computador><strong>Estimación de la profundidad en visión por computador</strong>
<a class=anchor href=#estimaci%c3%b3n-de-la-profundidad-en-visi%c3%b3n-por-computador>#</a></h3><p>El objetivo de la estimación de la profundidad es obtener una representación de la estructura espacial de una escena, recuperando la forma tridimensional y es aspecto de los objetos. Se busca recuperar información perdida dada información insuficiente para especificar totalmente la solución. Es decir, el mapeo de 2D a 3D no es único.</p><p>El aprendizaje profundo tiene un desempeño sobresaliente en tareas perceptuales y cognitivas como reconocimiento, detección y comprensión de escenas. La percepción de la profundidad se encuentra dentro de estas categorías.</p><img alt="Deep Learning for Depth Estimation" src=https://ars.els-cdn.com/content/image/1-s2.0-S0925231220320014-gr6.jpg><p>Google tiene un modelo de reconocimiento de manos utilizando su plataforma MediaPipe [4] (una plataforma que permite hacer pipelines de datos perceptuales: video y audio) que consiste en un pipeline de dos modelos:</p><p>El primer modelo es un detector de palma llamado BlazePalm, con una arquitectura de <strong>single shot detection</strong>[5]:</p><img alt="Epipolar Geometry" src=https://miro.medium.com/max/1400/1*51joMGlhxvftTxGtA4lA7Q.png><p>La idea de entrenar un detector de palma en vez de uno de manos es debido a que es mucho más fácil estimar cuadros delimitadores en objetos rígidos como una palma en vez de manos con dedos articulados. Adicionalmente, como las palmas son objetos pequeños el algoritmos Non-Maximum Supression[6], utilizado para seleccionar el mejor cuadro delimitador funciona bien incluso en casos de oclusión.</p><img alt="Hand Landmark Model" src=https://1.bp.blogspot.com/-8SxmsK5VoJ0/XVrTpMrJDFI/AAAAAAAAEiM/nAa3vuj8a2sjgEPAeMKXD4m09yKUgjVIQCLcBGAs/s640/Screenshot%2B2019-08-19%2Bat%2B9.51.25%2BAM.png><p>El segundo modelo de detección que localiza 21 puntos clave de la mano usando regresión, lo cual genera la prediccipon de una coordenada directa. Para obtener datos verídicos se etiquetaron para el entrenamiento más de 30000 imágenes reales con coordenadas 3D de cada uno de los 21 puntos clave, tambien se renderizaron modelos de alta calidad en diferentes fondos y se etiquetaron las coordenadas correspondientes. Esta combinación de datos sintéticos y reales dio lugar al siguiente esquema de entrenamiento del modelo:</p><img alt="Mixed Training Schema" src=https://1.bp.blogspot.com/-s_rfpl9S-sQ/XVrS_bzhcKI/AAAAAAAAEhc/_OrSe3VDLt8o1L6l2mA5HJsaqVZdaObpgCEwYBhgL/s1600/image5.png><p>El proposito de este taller fue utilizar el modelo anteriormente descrito en su implementación en la librería ML5, para que el usuario de una aplicación de pintar en 3d pudiera manejar la profundidad a la que se pinta utilizando una de sus manos.</p><h2 id=resultados><strong>Resultados</strong>
<a class=anchor href=#resultados>#</a></h2><details><summary>Código del sketch</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>handpose</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>video</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>hands</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>canvas</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>600</span>, <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>parent</span>(<span style=color:#e6db74>&#39;sketch-holder&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>video</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createCapture</span>(<span style=color:#a6e22e>VIDEO</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>video</span>.<span style=color:#a6e22e>size</span>(<span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>handpose</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ml5</span>.<span style=color:#a6e22e>handpose</span>(<span style=color:#a6e22e>video</span>, <span style=color:#a6e22e>modelReady</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// This sets up an event that fills the global variable &#34;predictions&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// with an array every time new hand poses are detected
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>handpose</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;hand&#34;</span>, <span style=color:#a6e22e>results</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>hands</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>results</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>calculateDepth</span>();
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Hide the video element, and just show the canvas
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>video</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>modelReady</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Model ready!&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>image</span>(<span style=color:#a6e22e>video</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// We can call both functions to draw all keypoints and the skeletons
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>drawKeypoints</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// A function to draw ellipses over the detected keypoints
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>drawKeypoints</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>hands</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>hand</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hands</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>hand</span>.<span style=color:#a6e22e>landmarks</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>keypoint</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hand</span>.<span style=color:#a6e22e>landmarks</span>[<span style=color:#a6e22e>j</span>];
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ellipse</span>(<span style=color:#a6e22e>keypoint</span>[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>keypoint</span>[<span style=color:#ae81ff>1</span>], <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>calculateDepth</span>(){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>hands</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span> ){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>hand</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hands</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mean</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>hand</span>.<span style=color:#a6e22e>landmarks</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>+=</span><span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>keypoint</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hand</span>.<span style=color:#a6e22e>landmarks</span>[<span style=color:#a6e22e>j</span>];
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mean</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>keypoint</span>[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>max_depth</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>60</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>min_depth</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>depth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mean</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>hand</span>.<span style=color:#a6e22e>landmarks</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>*</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>depth</span> <span style=color:#f92672>-=</span> <span style=color:#a6e22e>min_depth</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>depth</span> <span style=color:#f92672>/=</span> <span style=color:#a6e22e>max_depth</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>min_depth</span>;
</span></span><span style=display:flex><span>    document.<span style=color:#a6e22e>cookie</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;depth=&#34;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>depth</span>.<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details><script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/addons/p5.sound.min.js></script>
<script src=https://unpkg.com/ml5@latest/dist/ml5.min.js></script><div id=sketch-holder><script src=/showcase/sketches/handPose.js></script></div><div id=handPose></div><iframe id=3dbrush style=width:625px;height:475px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/addons/p5.sound.min.js></script>
             <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js></script> 
             <script src=https://cdn.jsdelivr.net/gh/freshfork/p5.EasyCam@1.2.1/p5.easycam.js></script> 
            
            
            
            <script src=/showcase/sketches/3dbrush.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe>
<details><summary>Código del sketch</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Goal in the 3d Brush is double, to implement:
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 1. a gesture parser to deal with depth, i.e.,
</span></span></span><span style=display:flex><span><span style=color:#75715e>// replace the depth slider with something really
</span></span></span><span style=display:flex><span><span style=color:#75715e>// meaningful. You may use a 3d sensor hardware
</span></span></span><span style=display:flex><span><span style=color:#75715e>// such as: https://en.wikipedia.org/wiki/Leap_Motion
</span></span></span><span style=display:flex><span><span style=color:#75715e>// or machine learning software to parse hand (or
</span></span></span><span style=display:flex><span><span style=color:#75715e>// body) gestures from a (video) / image, such as:
</span></span></span><span style=display:flex><span><span style=color:#75715e>// https://ml5js.org/
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 2. other brushes to stylize the 3d brush, taking
</span></span></span><span style=display:flex><span><span style=color:#75715e>// into account its shape and alpha channel, gesture
</span></span></span><span style=display:flex><span><span style=color:#75715e>// speed, etc.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Brush controls
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>color</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>depth</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>brush</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>easycam</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>escorzo</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>points</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>record</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>600</span>, <span style=color:#ae81ff>450</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// easycam stuff
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>distance</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>250</span>,           <span style=color:#75715e>// scalar
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>center</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],       <span style=color:#75715e>// vector
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>rotation</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],  <span style=color:#75715e>// quaternion
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  };
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>easycam</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createEasyCam</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>easycam</span>.<span style=color:#a6e22e>state_reset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>;   <span style=color:#75715e>// state to use on reset (double-click/tap)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>easycam</span>.<span style=color:#a6e22e>setState</span>(<span style=color:#a6e22e>state</span>, <span style=color:#ae81ff>2000</span>); <span style=color:#75715e>// now animate to that state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>escorzo</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>perspective</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// brush stuff
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>points</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>color</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createColorPicker</span>(<span style=color:#e6db74>&#39;#ed225d&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>color</span>.<span style=color:#a6e22e>position</span>(<span style=color:#a6e22e>width</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>70</span>, <span style=color:#ae81ff>40</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// select initial brush
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>brush</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sphereBrush</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>update</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>120</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>0.8</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#39;magenta&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>grid</span>({ <span style=color:#a6e22e>dotted</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>axes</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>point</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>points</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>point</span>.<span style=color:#a6e22e>worldPosition</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>brush</span>(<span style=color:#a6e22e>point</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>update</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>mouseX</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>pmouseX</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>mouseY</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>pmouseY</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>speed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>constrain</span>((<span style=color:#a6e22e>dx</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>dy</span>) <span style=color:#f92672>/</span> (<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> (<span style=color:#a6e22e>width</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>height</span>)), <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>record</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>depth</span> <span style=color:#f92672>=</span> parseFloat(document.<span style=color:#a6e22e>cookie</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>6</span>,document.<span style=color:#a6e22e>cookie</span>.<span style=color:#a6e22e>length</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>depth</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>points</span>.<span style=color:#a6e22e>push</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>worldPosition</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>treeLocation</span>([<span style=color:#a6e22e>mouseX</span>, <span style=color:#a6e22e>mouseY</span>, <span style=color:#a6e22e>depth</span>], { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;SCREEN&#39;</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;WORLD&#39;</span> }),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>color</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>.<span style=color:#a6e22e>color</span>(),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>speed</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>speed</span>
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>sphereBrush</span>(<span style=color:#a6e22e>point</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>  <span style=color:#75715e>// TODO parameterize sphere radius and / or
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// alpha channel according to gesture speed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>point</span>.<span style=color:#a6e22e>color</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sphere</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>keyPressed</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;r&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>record</span> <span style=color:#f92672>=</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>record</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;p&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>escorzo</span> <span style=color:#f92672>=</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>escorzo</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>escorzo</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>perspective</span>() <span style=color:#f92672>:</span> <span style=color:#a6e22e>ortho</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;c&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>points</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>mouseWheel</span>(<span style=color:#a6e22e>event</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>//comment to enable page scrolling
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details><h3 id=conclusiones><strong>Conclusiones</strong>
<a class=anchor href=#conclusiones>#</a></h3><ul><li>Las redes neuronales son ampliamente usadas en el problema de la estimación de profundidad, dejando de lado los algoritmos tradicionales.</li><li>A pesar que el modelo de detección de manos no es un modelo específicamente diseñado para estimar profundidad, es posible utilizarlo para realizar una sencilla estimación para aplicaciones sencillas que requieran la manipulación de esta por medio de las manos..</li></ul><h3 id=trabajo-futuro><strong>Trabajo Futuro</strong>
<a class=anchor href=#trabajo-futuro>#</a></h3><p>Como trabajo futuro es muy recomendable utilizar alguno de los modelos de estimación dee profundidad que se encuentran en la literatura, probar diferentes alternativas dentro del aprendizaje supervizado, no supervizado y semi supervizado.</p><h3 id=referencias><strong>Referencias</strong>
<a class=anchor href=#referencias>#</a></h3><p>[1] Depth Estimation: Basics and Intuition,Daryl Tan. 2020. Towards Data Science.
<a href=https://towardsdatascience.com/depth-estimation-1-basics-and-intuition-86f2c9538cd1>https://towardsdatascience.com/depth-estimation-1-basics-and-intuition-86f2c9538cd1</a><br>[2] Yue Ming, Xuyang Meng, Chunxiao Fan, Hui Yu,
Deep learning for monocular depth estimation: A review,
Neurocomputing,
Volume 438,2021,Pages 14-33,ISSN 0925-2312, <a href=https://doi.org/10.1016/j.neucom.2020.12.089>https://doi.org/10.1016/j.neucom.2020.12.089</a>.
(<a href=https://www.sciencedirect.com/science/article/pii/S0925231220320014>https://www.sciencedirect.com/science/article/pii/S0925231220320014</a>)
[3] <a href=https://en.wikipedia.org/wiki/Epipolar_geometry>https://en.wikipedia.org/wiki/Epipolar_geometry</a><br>[4] On-Device, Real-Time Hand Tracking with MediaPipe
Monday, August 19, 2019
by Valentin Bazarevsky and Fan Zhang, Research Engineers, Google Research
<a href=https://ai.googleblog.com/2019/08/on-device-real-time-hand-tracking-with.html>https://ai.googleblog.com/2019/08/on-device-real-time-hand-tracking-with.html</a>
[5] SSD: Single Shot MultiBox Detector
Wei Liu, Dragomir Anguelov, Dumitru Erhan, Christian Szegedy, Scott Reed, Cheng-Yang Fu, Alexander C. Berg
<a href=https://arxiv.org/abs/1512.02325>https://arxiv.org/abs/1512.02325</a><br>[6] Non Maximum Suppression: Theory and Implementation in PyTorch. Jatin Prakash. 2021.
<a href=https://learnopencv.com/non-maximum-suppression-theory-and-implementation-in-pytorch/>https://learnopencv.com/non-maximum-suppression-theory-and-implementation-in-pytorch/</a>
[7] <a href=https://learn.ml5js.org/#/reference/handpose>https://learn.ml5js.org/#/reference/handpose</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/visualcomputing/showcase/commit/192192ee895d823350901ed9a38fe72a4351f5fe title="Last modified by Sebastian Rojas | May 25, 2022" target=_blank rel=noopener><img src=/showcase/svg/calendar.svg class=book-icon alt=Calendar>
<span>May 25, 2022</span></a></div></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#workshop-2-3d-brush-with-depth-estimation>Workshop 2: 3D Brush with Depth Estimation</a><ul><li><a href=#introducción><strong>Introducción</strong></a><ul><li><a href=#depth-estimation><strong>Depth Estimation</strong></a></li></ul></li><li><a href=#contexto><strong>Contexto</strong></a><ul><li><a href=#estimación-de-la-profundidad-en-visión-por-computador><strong>Estimación de la profundidad en visión por computador</strong></a></li></ul></li><li><a href=#resultados><strong>Resultados</strong></a><ul><li><a href=#conclusiones><strong>Conclusiones</strong></a></li><li><a href=#trabajo-futuro><strong>Trabajo Futuro</strong></a></li><li><a href=#referencias><strong>Referencias</strong></a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>